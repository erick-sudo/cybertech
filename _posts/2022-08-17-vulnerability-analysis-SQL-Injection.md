---
layout: post
title:  Security Vulnerabilities
subtitle: SQL/NOSQL Injection Vulnerability
categories: SQL Injection
tags: [SQL]
---

## SQL/NOSQL Injection

### Overview
NoSQL injection is a security weakness in a web application that uses a NoSQL database. NoSQL (Not Only SQL) refers to database systems that use more flexible data formats and do not support Structured Query Language (SQL). They typically store and manage data as key-value pairs, documents, or data graphs.

A NoSQL injection, similar to that of a SQL injection, can allow attackers to bypass authentication, exfiltrate sensitive data, tamper with data on the database, or even compromise the database and the underlying server.
Most NoSQL injection vulnerabilities occur because developers accept and process user inputs without properly sanitizing them.

The following source code is an example of a an SQL/NOSQL Injection vulnerability identified by [ReShift](https://reshiftsecurity.com), a Static Application Security Testing (SAST) tool.

![code vulnerable to sql injection](/assets/images/vulnerabilities/sql_injection.png)

SQL Injection (SQLi) vulnerabilities occurs when server software creates SQL commands from user input received from the browser client without proper controls. The server software receives and inserts input from the user browser into SQL statements it sends to the database.

### Impact
When this occurs, the attacker can then control the database, >allowing sensitive data to be exposed>, content to be changes, or the >entire database can be deleted>.

### Remediations
An unsafe example below takes untrusted user input and concatenates or inserts directly into a SQL command string.
```
    const app = require("express"),
        pg = require("pg);,
        client = new pg.Client("postgres://postgres:postgres@localhost:5432/db");

    client.connect();

    app.get("user", function handler(req, res) {
        let query = "SELECT * FROM users WHERE email ="+ req.params.email;
        client.query(query).then((result) => {
            res.end(result);
        });
    });
```

A fix for this vulnerability would be using Parameterized queris, as follows:
```
    const app = require("express"),
        pg = require("pg);,
        client = new pg.Client("postgres://postgres:postgres@localhost:5432/db");

    client.connect();

    app.get("user", function handler(req, res) {
        let query = "SELECT * FROM users WHERE email = `$1`";
        client.query(query, `req.params.email`).then((result) => {
            res.end(result);
        });
    });
```